# **受控 Markdown 公文解析与渲染规范（v1.0）**

## **1. 设计目标**

本规范用于约定 **Agent 与公文生成脚本之间的输入协议**。

目标是：

- 不做通用 Markdown 转换
- 不做语义推断、不做自动编号
- 只根据**段落起始标记**进行确定性渲染
- 将 Markdown 作为一种**受控的结构化输入格式**
- 最终稳定生成符合既定公文格式的 Word（.docx）文件

## **2. 总体约定（非常重要）**

1. **编号全部由 Agent 负责输出**
   - 脚本 **不生成、不补全、不校验编号连续性**
   - 如：“一、”“（一）”“1.”“（1）”等，必须在 Markdown 中显式出现
2. **自然换行即自然段**
   - 每一行非空文本 = 一个 Word 段落
   - 空行仅作为可读性分隔，对渲染无额外语义
3. **只检测段落开头的** **#**
   - 仅当一行以 # 开头时，才视为“标题段落”
   - 行中或行尾出现的 # 一律忽略
4. **字体由脚本在本地相对路径中配置**
   - Markdown 中不涉及字体、字号、行距等样式信息
   - 所有版式由渲染脚本统一控制

## **3. Front Matter（元信息区）**

### **3.1 形式**

文档可选以 **YAML Front Matter** 开头：

```
---
recipients: 各相关单位
signer: XX单位
date: 2026年1月30日
attachments:
  - 年度工作总结模板
---
```

- Front Matter 必须位于文件最开头
- 以 --- 开始，以 --- 结束
- 若不存在 Front Matter，则正文从第一行开始解析

### **3.2 支持字段（v1.0）**

| **字段名**  | **类型**               | **说明**                 |
| ----------- | ---------------------- | ------------------------ |
| recipients  | string \| list[string] | 主送机关                 |
| signer      | string                 | 落款单位                 |
| date        | string                 | 成文日期（不做格式解析） |
| attachments | list[string]           | 附件列表                 |

> 未识别字段将被忽略，不影响正文解析。

## **4. Markdown 正文解析规则**

### **4.1 标题层级定义（核心规则）**

仅根据**行首连续 # 的数量**判断段落类型：

| **Markdown 形式** | **含义** | **渲染语义**         |
| ----------------- | -------- | -------------------- |
| # 标题            | 公文标题 | 居中，小标宋，2 号   |
| ## ...            | 一级标题 | 黑体，3 号           |
| ### ...           | 二级标题 | 楷体，3 号           |
| #### ...          | 三级标题 | 仿宋，3 号           |
| ##### ...         | 四级标题 | 仿宋，3 号           |
| 其他非空行        | 正文     | 仿宋，3 号，首行缩进 |

说明：

- 标题文本为去掉 # 后的内容（不额外修改）
- 标题是否包含编号，完全由 Agent 决定
- 不支持超过 ##### 的标题层级

### **4.2 正文段落**

```
这是第一自然段。
这是第二自然段。
```

- 每一行非空文本 → 一个 Word 段落
- 默认：
  - 仿宋
  - 3 号
  - 固定行距
  - 首行缩进 2 字符

### **4.3 不支持的 Markdown 语法（v1.0）**

以下语法**不解析、不报错，按普通文本处理**：

- 列表（-、*、1.）
- 加粗 / 斜体（** / *）
- 链接、图片
- 引用（>）
- 表格
- 行内代码

> 请不要输出以上符号，以免在word测渲染出这些符号。

## **5. 渲染规则（Word 侧）**

### **5.1 通用段落规则**

- 段前 / 段后：0
- 行距：固定值（如 29pt）
- 不启用 Word 自动编号
- 不启用样式继承（全部由脚本显式设置）

### **5.2 特殊结构渲染**

#### **主送机关**

- 位于标题下方
- 左对齐
- 格式示例：

```
各相关单位：
```

#### **附件**

- 位于正文后
- 单个附件：

```
附件：年度工作总结模板
```

- 多个附件：

```
附件：1. xxx
    2. xxx
```

#### **落款与日期**

- 位于文末
- 右对齐
- 占用独立段落

### **5.3 页码**

- 页脚居中
- 格式：— 1 —
- 使用 Word 原生字段（PAGE）

## **6. 错误与校验策略（v1.0）**

- 不校验标题层级是否跳级
- 不校验编号格式或连续性
- 不校验正文内容合法性
- 若 Markdown 语法不符合规范：
  - 能解析则解析
  - 不能解析则按普通正文输出

## **7. 使用边界声明**

本规范**仅适用于以下场景**：

- Agent 与脚本协商生成 Markdown
- 输入完全受控
- 目标是稳定生成特定格式的公文 docx

**不适用于**：

- 通用 Markdown 文档
- 人工随意编辑的 Markdown
- 富文本 / 多样式排版需求

